<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- Created on December 27, 2019 by texi2html 5.0
texi2html was written by: 
            Lionel Cons <Lionel.Cons@cern.ch> (original author)
            Karl Berry  <karl@freefriends.org>
            Olaf Bachmann <obachman@mathematik.uni-kl.de>
            and many others.
Maintained by: Many creative people.
Send bugs and suggestions to <texi2html-bug@nongnu.org>
-->
<head>
<title>BERKELEY LOGO 6.1: 9 Macros</title>

<meta name="description" content="BERKELEY LOGO 6.1: 9 Macros">
<meta name="keywords" content="BERKELEY LOGO 6.1: 9 Macros">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="texi2html 5.0">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
<!--
a.summary-letter {text-decoration: none}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
pre.display {font-family: serif}
pre.format {font-family: serif}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: serif; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: serif; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nocodebreak {white-space:pre}
span.nolinebreak {white-space:pre}
span.roman {font-family:serif; font-weight:normal}
span.sansserif {font-family:sans-serif; font-weight:normal}
ul.no-bullet {list-style: none}
-->
</style>


</head>

<body lang="en" bgcolor="#FFFFFF" text="#000000" link="#0000FF" vlink="#800080" alink="#FF0000">

<a name="MACROS"></a>
<table class="header" cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="usermanual_8.html#CONTROL-STRUCTURES" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="usermanual_8.html#TRANSFER" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[ Up ]</td>
<td valign="middle" align="left">[<a href="#dMACRO" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left">[<a href="usermanual_10.html#ERROR-PROCESSING" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="usermanual.html#INTRODUCTION" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_13.html#INDEX" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="Macros"></a>
<h1 class="chapter">9 Macros</h1>

<table class="menu" border="0" cellspacing="0">
<tr><td align="left" valign="top"><a href="#dMACRO">.macro</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#dDEFMACRO">.defmacro</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">
</td></tr>
<tr><td align="left" valign="top"><a href="#MACROP">macrop</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">                      
</td></tr>
<tr><td align="left" valign="top"><a href="#MACROEXPAND">macroexpand</a></td><td>&nbsp;&nbsp;</td><td align="left" valign="top">                 
</td></tr>
</table>

<hr>
<a name="dMACRO"></a>
<table class="header" cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#MACROS" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#MACROS" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#MACROS" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#dDEFMACRO" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left">[<a href="usermanual_10.html#ERROR-PROCESSING" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="usermanual.html#INTRODUCTION" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_13.html#INDEX" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="g_t_002emacro"></a>
<h2 class="unnumberedsec">.macro</h2>
<a name="index-_002emacro"></a>
<a name="index-_002edefmacro"></a>

<div class="example">
<pre class="example">.MACRO procname :input1 :input2 ...			(special form)
.DEFMACRO procname text
</pre></div>

<p>A macro is a special kind of procedure whose output is evaluated as Logo
instructions in the context of the macro&rsquo;s caller.  <code>.MACRO</code> is exactly
like <code>TO</code> except that the new procedure becomes a macro; <code>.DEFMACRO</code>
is exactly like <code>DEFINE</code> with the same exception.
</p>
<p>Macros are useful for inventing new control structures comparable to
<code>REPEAT</code>, <code>IF</code>, and so on.  Such control structures can almost, but
not quite, be duplicated by ordinary Logo procedures.  For example, here is an
ordinary procedure version of <code>REPEAT</code>:
</p>
<div class="example">
<pre class="example">to my.repeat :num :instructions
if :num=0 [stop]
run :instructions
my.repeat :num-1 :instructions
end
</pre></div>

<p>This version works fine for most purposes, e.g.,
</p>
<div class="example">
<pre class="example">my.repeat 5 [print &quot;hello]
</pre></div>

<p>But it doesn&rsquo;t work if the instructions to be carried out include
<code>OUTPUT</code>, <code>STOP</code>, or <code>LOCAL</code>.  For example, consider this
procedure:
</p>
<div class="example">
<pre class="example">to example
print [Guess my secret word.  You get three guesses.]
repeat 3 [type &quot;|?? | ~
          if readword = &quot;secret [pr &quot;Right! stop]]
print [Sorry, the word was &quot;secret&quot;!]
end
</pre></div>

<p>This procedure works as written, but if <code>MY.REPEAT</code> is used instead of
<code>REPEAT</code>, it won&rsquo;t work because the <code>STOP</code> will stop
<code>MY.REPEAT</code> instead of stopping <code>EXAMPLE</code> as desired.
</p>
<p>The solution is to make <code>MY.REPEAT</code> a macro.  Instead of actually carrying
out the computation, a macro must return a list containing Logo
instructions.  The contents of that list are evaluated as if they
appeared in place of the call to the macro.  Here&rsquo;s a macro version of
<code>REPEAT</code>:
</p>
<div class="example">
<pre class="example">.macro my.repeat :num :instructions
if :num=0 [output []]
output sentence :instructions ~
                (list &quot;my.repeat :num-1 :instructions)
end
</pre></div>

<p>Every macro is an operation &mdash; it must always output something.  Even in
the base case, <code>MY.REPEAT</code> outputs an empty instruction list.  To show how
<code>MY.REPEAT</code> works, let&rsquo;s take the example
</p>
<div class="example">
<pre class="example">my.repeat 5 [print &quot;hello]
</pre></div>

<p>For this example, <code>MY.REPEAT</code> will output the instruction list
</p>
<div class="example">
<pre class="example">[print &quot;hello my.repeat 4 [print &quot;hello]]
</pre></div>

<p>Logo then executes these instructions in place of the original invocation of
<code>MY.REPEAT</code>; this prints <code>hello</code> once and invokes another
repetition.
</p>
<p>The technique just shown, although fairly easy to understand, has the
defect of slowness because each repetition has to construct an
instruction list for evaluation.  Another approach is to make <code>MY.REPEAT</code>
a macro that works just like the non-macro version unless the
instructions to be repeated include <code>OUTPUT</code> or <code>STOP</code>:
</p>
<div class="example">
<pre class="example">.macro my.repeat :num :instructions
catch &quot;repeat.catchtag ~
      [op repeat.done runresult [repeat1 :num :instructions]]
op []
end

to repeat1 :num :instructions
if :num=0 [throw &quot;repeat.catchtag]
run :instructions
.maybeoutput repeat1 :num-1 :instructions
end

to repeat.done :repeat.result
if emptyp :repeat.result [op [stop]]
op list &quot;output quoted first :repeat.result
end
</pre></div>

<p>If the instructions do not include <code>STOP</code> or <code>OUTPUT</code>, then
<code>REPEAT1</code> will reach its base case and invoke <code>THROW</code>.  As a result,
<code>MY.REPEAT</code>&rsquo;s last instruction line will output an empty list, so the
evaluation of the macro result by the caller will do nothing.  But if a
<code>STOP</code> or <code>OUTPUT</code> happens, then <code>REPEAT.DONE</code> will output a
<code>STOP</code> or <code>OUTPUT</code> instruction that will be executed in the
caller&rsquo;s context.
</p>
<p>The macro-defining commands have names starting with a dot because
macros are an advanced feature of Logo; it&rsquo;s easy to get in trouble by
defining a macro that doesn&rsquo;t terminate, or by failing to construct the
instruction list properly.
</p>
<p>Lisp users should note that Logo macros are <em>not</em> special forms.  That is,
the inputs to the macro are evaluated normally, as they would be for any
other Logo procedure.  It&rsquo;s only the output from the macro that&rsquo;s
handled unusually.
</p>
<p>Here&rsquo;s another example:
</p>
<div class="example">
<pre class="example">.macro localmake :name :value
output (list &quot;local          ~
             word &quot;&quot; :name   ~
             &quot;apply          ~
             &quot;&quot;make          ~
             (list :name :value))
end
</pre></div>

<p>It&rsquo;s used this way:
</p>
<div class="example">
<pre class="example">to try
localmake &quot;garply &quot;hello
print :garply
end
</pre></div>

<p><code>LOCALMAKE</code> outputs the list
</p>
<div class="display">
<pre class="display">[local &quot;garply apply &quot;make [garply hello]]
</pre></div>

<p>The reason for the use of <code>APPLY</code> is to avoid having to decide whether or
not the second input to <code>MAKE</code> requires a quotation mark before it.  (In
this case it would &mdash; <code>MAKE &quot;GARPLY &quot;HELLO</code> &mdash; but the quotation mark
would be wrong if the value were a list.)
</p>
<p>It&rsquo;s often convenient to use the <tt>&lsquo;</tt> function to construct the instruction
list:
</p>
<div class="example">
<pre class="example">.macro localmake :name :value
op `[local ,[word &quot;&quot; :name] apply &quot;make [,[:name] ,[:value]]]
end
</pre></div>

<p>On the other hand, <tt>&lsquo;</tt> is pretty slow, since it&rsquo;s tree recursive and
written in Logo.
</p>
<p>See section <a href="usermanual_7.html#TO">to</a> ,
<a href="usermanual_7.html#DEFINE">define</a> ,
<a href="usermanual_8.html#APPLY">apply</a> ,
<a href="usermanual_8.html#STOP">stop</a> ,
<a href="usermanual_8.html#OUTPUT">output</a> .
</p>
<hr>
<a name="dDEFMACRO"></a>
<table class="header" cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#MACROS" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#dMACRO" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#dMACRO" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#MACROP" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left">[<a href="usermanual_10.html#ERROR-PROCESSING" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="usermanual.html#INTRODUCTION" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_13.html#INDEX" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="g_t_002edefmacro"></a>
<h3 class="unnumberedsubsec">.defmacro</h3>

<p>See section <a href="#dMACRO">.macro</a> .
</p>
<hr>
<a name="MACROP"></a>
<table class="header" cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#MACROS" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#dDEFMACRO" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#dMACRO" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="#MACROEXPAND" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left">[<a href="usermanual_10.html#ERROR-PROCESSING" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="usermanual.html#INTRODUCTION" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_13.html#INDEX" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="macrop"></a>
<h3 class="unnumberedsubsec">macrop</h3>
<a name="index-macrop"></a>
<a name="index-macro_003f"></a>

<div class="example">
<pre class="example">MACROP name
MACRO? name
</pre></div>

<p>outputs <code>TRUE</code> if its input is the name of a macro.
</p>
<hr>
<a name="MACROEXPAND"></a>
<table class="header" cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#MACROS" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="#MACROP" title="Previous section in reading order"> &lt; </a>]</td>
<td valign="middle" align="left">[<a href="#dMACRO" title="Up section"> Up </a>]</td>
<td valign="middle" align="left">[<a href="usermanual_10.html#ERROR-PROCESSING" title="Next section in reading order"> &gt; </a>]</td>
<td valign="middle" align="left">[<a href="usermanual_10.html#ERROR-PROCESSING" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="usermanual.html#INTRODUCTION" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_13.html#INDEX" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<a name="macroexpand"></a>
<h3 class="unnumberedsubsec">macroexpand</h3>
<a name="index-macroexpand"></a>

<div class="example">
<pre class="example">MACROEXPAND expr				(library procedure)
</pre></div>

<p>takes as its input a Logo expression that invokes a macro (that is, one
that begins with the name of a macro) and outputs the the Logo
expression into which the macro would translate the input expression.
</p>
<div class="example">
<pre class="example">.macro localmake :name :value
op `[local ,[word &quot;&quot; :name] apply &quot;make [,[:name] ,[:value]]]
end

? show macroexpand [localmake &quot;pi 3.14159]
[local &quot;pi apply &quot;make [pi 3.14159]]
</pre></div>



<hr>
<table class="header" cellpadding="1" cellspacing="1" border="0">
<tr><td valign="middle" align="left">[<a href="#MACROS" title="Beginning of this chapter or previous chapter"> &lt;&lt; </a>]</td>
<td valign="middle" align="left">[<a href="usermanual_10.html#ERROR-PROCESSING" title="Next chapter"> &gt;&gt; </a>]</td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left"> &nbsp; </td>
<td valign="middle" align="left">[<a href="usermanual.html#INTRODUCTION" title="Cover (top) of document">Top</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_toc.html#SEC_Contents" title="Table of contents">Contents</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_13.html#INDEX" title="Index">Index</a>]</td>
<td valign="middle" align="left">[<a href="usermanual_abt.html#SEC_About" title="About (help)"> ? </a>]</td>
</tr></table>
<p>
 <font size="-1">
  This document was generated on <i>December 27, 2019</i> using <a href="http://www.nongnu.org/texi2html/"><i>texi2html 5.0</i></a>.
 </font>
 <br>

</p>
</body>
</html>
